# EML Mail Viewer

**¡Tambien disponible en español! al ejecutar el programa podras seleccionar el idioma a tu gusto. Puedes traducir este texto con el traductor de tu navegador preferido.**

## Overview

The EML Mail Viewer is a web-based application designed to browse, view, and manage email backups that have been downloaded as `.eml` files. It provides a user-friendly interface to list emails, filter them based on various criteria, preview their content, and download the original files.

**Important:** This program works in conjunction with the **pop3mail-downloader** project. The `pop3mail-downloader` is responsible for fetching emails from a POP3 server and storing them along with their metadata, which this EML Mail Viewer then uses to display and manage the emails.

## Features

*   **Email Listing:** Displays a paginated list of all backed-up emails, showing:
    *   Date and Time
    *   Subject
    *   Sender
    *   Recipient (POP3 Mailbox the email was downloaded for)
    *   Email Size
    *   Action buttons (View, Download)
*   **Advanced Filtering:**
    *   Filter emails by Subject content.
    *   Filter emails by Sender.
    *   Filter emails by Recipient (POP3 Mailbox).
    *   Filter emails by a specific Date.
*   **Pagination Controls:**
    *   Navigate through email pages using "Next" and "Previous" buttons.
    *   Directly jump to a specific page number.
    *   Select the number of emails to display per page (10, 20, 50, 100).
*   **Email Viewing:**
    *   Open a simplified HTML preview of an email in a new browser tab.
    *   The preview displays key headers (Date/Time, From, To, CC, Subject, Account) and the email body.
    *   If HTML content is present in the `.eml` file, it will be rendered; otherwise, plain text content is shown.
    *   A "Download Email" button is available directly within the preview page.
*   **Email Downloading:**
    *   Download the original `.eml` file directly from the email list or the preview page.
*   **Spam Detection & Handling:**
    *   Emails identified as spam are visually highlighted in the email list (e.g., red background, border).
    *   A warning modal appears before allowing the user to view or download an email marked as spam, prompting for confirmation.
    *   Spam filtering logic is configurable via a `spam_settings.json` file and considers:
        *   Sender email/domain whitelists and blacklists.
        *   Keyword whitelists and blacklists in the email subject.
        *   Pre-existing `spam_filter_whitelist` and `spam_filter` flags in the email metadata (generated by `pop3mail-downloader`).
        *   A `spam_score` compared against a configurable `score_limit`.
*   **User Data Management:**
    *   The application automatically creates and uses a `Pop3MailDownloader_UserData` directory located in the user's `Documents` folder (e.g., `C:\Users\YourUser\Documents\Pop3MailDownloader_UserData`).
    *   This directory is expected to contain:
        *   `emails_metadata.json`: A JSON file with metadata for all downloaded emails (generated by `pop3mail-downloader`).
        *   `spam_settings.json` (optional): A user-configurable JSON file for spam filter settings. If not present, default settings are used.
        *   `emails/`: A subdirectory containing the actual `.eml` files, organized by year/month/day/recipient (as structured by `pop3mail-downloader`).
*   **Responsive UI:** The web interface is designed to be responsive and usable on different screen sizes.
*   **Loading Indicator:** A visual loading indicator with a spinner is displayed during data fetching and processing operations.

## Prerequisites

*   **Python 3.x:** The server-side script (`server.py`) is written in Python.
*   **Companion Project Data:** You must have already run the pop3mail-downloader project. This tool will download your emails and create the necessary `Pop3MailDownloader_UserData` directory with `emails_metadata.json` and the `.eml` files in your `Documents` folder.

## Setup and Usage

1.  **Ensure Data Exists:**
    *   Run the pop3mail-downloader tool first. This will create the `Pop3MailDownloader_UserData` directory in your `Documents` folder, along with `emails_metadata.json` and the subdirectories containing your `.eml` email files.
    *   The EML Mail Viewer relies entirely on this data structure.

2.  **Configure Spam Settings (Optional):**
    *   If you wish to customize the spam filter, create or edit the `spam_settings.json` file within the `Pop3MailDownloader_UserData` directory.
    *   The file should follow this JSON structure (values shown are examples):
        ```json
        {
            "score_limit": 5,
            "blacklist_words": ["lottery", "urgent prize"],
            "blacklist_emails": ["spammer@example.com"],
            "blacklist_domains": ["spamdomain.com"],
            "whitelist_words": ["important report", "meeting_summary"],
            "whitelist_emails": ["trusted_sender@example.com"],
            "whitelist_domains": ["mycompany.com", "partner.org"]
        }
        ```
    *   If this file is not present or is malformed, the application will use default internal spam settings (which initially might be empty or very basic, as seen in `server.py`'s `DEFAULT_SPAM_SETTINGS`).

3.  **Run the Server:**
    *   Navigate to the directory where `server.py` is located using your terminal or command prompt.
    *   Execute the server script:
        ```bash
        python server.py
        ```
    *   You should see log messages indicating the server has started, typically on `http://0.0.0.0:8000`.

4.  **Access the Viewer:**
    *   Open your web browser (e.g., Chrome, Firefox, Edge).
    *   Navigate to `http://localhost:8000`.
    *   If accessing from another device on the same network, replace `localhost` with the IP address of the machine running `server.py` (e.g., `http://192.168.1.10:8000`).

5.  **Using the Interface:**
    *   **Browse Emails:** The main page will list your emails. Use the pagination controls at the top and bottom of the table to navigate.
    *   **Filter:** Use the filter bar at the top to search by subject, sender, recipient (POP3 mailbox), or date. Click "Apply Filter" to see the results.
    *   **View Email:** Click the "Ver" (View) button next to an email to open its preview in a new tab.
    *   **Download Email:** Click the "Descargar" (Download) button to download the original `.eml` file.
    *   **Spam Warnings:** If you attempt to view or download an email marked as spam, a modal will appear asking for confirmation before proceeding.

## How It Works

The application consists of two main parts:

*   **`server.py`:** A Python HTTP server that:
    *   Serves the `index.html` file and other static assets (if any).
    *   Provides API endpoints (`/list-eml`, `/view-html-eml`, `/download-eml`) to interact with the email data.
    *   Reads `emails_metadata.json` to get the list and details of emails.
    *   Reads `spam_settings.json` to apply spam filtering rules.
    *   Accesses the `.eml` files from the `Pop3MailDownloader_UserData/emails/` directory for viewing and downloading.
*   **`index.html`:** A single HTML file containing the user interface structure, CSS for styling, and JavaScript for:
    *   Fetching email data from the server.
    *   Dynamically rendering the email list and pagination.
    *   Handling user interactions (filtering, viewing, downloading).
    *   Displaying spam warnings.

## Spam Filtering Logic

The server determines if an email is spam based on the following prioritized rules, using settings from `spam_settings.json` (or defaults):

1.  **Sender Whitelist:** If the sender's email or domain is in `whitelist_emails` or `whitelist_domains`, it's **NOT spam**.
2.  **Subject Whitelist:** If any word from `whitelist_words` is found in the email subject, it's **NOT spam**.
3.  **Sender Blacklist:** If the sender's email or domain is in `blacklist_emails` or `blacklist_domains` (and not whitelisted above), it **IS spam**.
4.  **Subject Blacklist:** If any word from `blacklist_words` is found in the email subject (and not whitelisted above), it **IS spam**.
5.  **Spam Score:** If the email's `spam_score` (from metadata) is greater than the `score_limit` (from settings), it **IS spam**.
6.  **Default:** Otherwise, it's considered **NOT spam**.

---

*This README provides a general guide. Functionality and specific paths might vary slightly based on the exact version of the code.*
